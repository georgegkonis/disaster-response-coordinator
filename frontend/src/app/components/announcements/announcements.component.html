<div class="announcements">

    <p-toolbar styleClass="p-2">
        <div class="p-toolbar-group-start gap-2">
            <p-button (onClick)="onAddClick()" icon="pi pi-plus" label="Create"></p-button>
            <p-button (onClick)="onRemoveSelectedClick()"
                      [disabled]="selectedAnnouncementIds.length === 0"
                      icon="pi pi-trash"
                      label="Remove"
                      severity="danger"></p-button>
        </div>
        <div class="p-toolbar-group-end gap-2">
            <p-button (onClick)="onRefreshClick()" icon="pi pi-refresh"></p-button>
        </div>
    </p-toolbar>

    <p-table [(selection)]="selectedAnnouncementIds"
             [scrollable]="true"
             [tableStyle]="{'min-width': '80rem', 'max-height': '80vh'}"
             [value]="(announcements$ | async) ?? []"
             [sortOrder]="-1"
             dataKey="id"
             scrollHeight="80vh"
             sortField="updatedAt"
             sortMode="single"
             styleClass="p-datatable-sm">

        <ng-template pTemplate="header">
            <tr>
                <th style="width: 5%">
                    <p-tableHeaderCheckbox/>
                </th>
                <th pSortableColumn="description" style="width: 30%">Description
                    <p-sortIcon field="description"></p-sortIcon>
                </th>
                <th pSortableColumn="items" style="width: 30%">Items
                    <p-sortIcon field="items"></p-sortIcon>
                </th>
                <th pSortableColumn="createdAt" style="width: 15%">Created At
                    <p-sortIcon field="createdAt"></p-sortIcon>
                </th>
                <th pSortableColumn="updatedAt" style="width: 15%">Updated At
                    <p-sortIcon field="updatedAt"></p-sortIcon>
                </th>
                <th style="width: 5%"></th>
            </tr>
        </ng-template>

        <ng-template let-announcement pTemplate="body">
            <tr>
                <td>
                    <p-tableCheckbox [value]="announcement"/>
                </td>

                <td>{{ announcement.description }}</td>

                <td>{{ announcement.items | itemNames }}</td>

                <td>{{ announcement.createdAt | date: 'short' }}</td>

                <td>{{ announcement.updatedAt | date: 'short' }}</td>

                <td>
                    <div class="flex align-items-center justify-content-center gap-2">
                        <p-button (onClick)="onRemoveClick(announcement.id)"
                                  [outlined]="true"
                                  [rounded]="true"
                                  icon="pi pi-trash"
                                  severity="danger"
                                  size="small"></p-button>
                    </div>
                </td>
            </tr>
        </ng-template>

    </p-table>
</div>

<p-dialog [(visible)]="displayDialog" [modal]="true" [closable]="false" [style]="{width: '30rem'}">
    <ng-template pTemplate="headless">
        <form [formGroup]="announcementForm" class="app-form">

            <h1 class="app-form__heading col-12">Add Announcement</h1>

            <div class="app-form__field col-12">
                <label for="description" class="app-form__field__label">Description</label>
                <input pInputText type="text" id="description" formControlName="description" class="app-form__field__input">
            </div>

            <div class="app-form__field col-12">
                <label for="items" class="app-form__field__label">Items</label>
                <p-multiSelect [filter]="true"
                               [options]="(itemsSelection$ | async) ?? []"
                               [showClear]="true"
                               display="chip"
                               formControlName="items"
                               id="items"
                               panelStyleClass="w-full"
                               styleClass="w-full"></p-multiSelect>
            </div>

            <div class="app-form__buttons col-12">
                <p-button (onClick)="onCancelClick()" [outlined]="true" icon="pi pi-times" label="Cancel"></p-button>
                <p-button (onClick)="onSubmitClick()" [disabled]="!announcementForm.valid" icon="pi pi-check" label="Submit"></p-button>
            </div>
        </form>
    </ng-template>
</p-dialog>